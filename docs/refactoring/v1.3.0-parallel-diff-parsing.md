# v1.3.0: ë³‘ë ¬ Diff íŒŒì‹± (Parallel Diff Parsing)

## ğŸ“… ê°œìš”
- **ë²„ì „**: v1.3.0
- **ë‚ ì§œ**: 2026-02-06
- **ëª©í‘œ**: ëŒ€ê·œëª¨ ì»¤ë°‹ ì²˜ë¦¬ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•œ Worker Pool íŒ¨í„´ ë„ì…

## ğŸ¯ ë¬¸ì œ ì •ì˜

### ì„±ëŠ¥ ë³‘ëª© ì§€ì 
ê¸°ì¡´ êµ¬í˜„ì—ì„œ `GetCachedDiff()` í•¨ìˆ˜ëŠ” ìˆœì°¨ì ìœ¼ë¡œ diffë¥¼ íŒŒì‹±í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ëŒ€ê·œëª¨ ì»¤ë°‹(50+ íŒŒì¼)ì—ì„œ ì²˜ë¦¬ ì‹œê°„ì´ ê¸¸ì–´ì§€ëŠ” ì£¼ìš” ë³‘ëª© ì§€ì ì´ì—ˆìŠµë‹ˆë‹¤.

### ë¶„ì„ ê²°ê³¼
- **íŒŒì¼ ìˆ˜**: 50+ íŒŒì¼
- **íŒŒì‹± ì‹œê°„**: ë‹¨ì¼ íŒŒì¼ë‹¹ í‰ê·  1-2ms
- **ì´ ì²˜ë¦¬ ì‹œê°„**: ìˆœì°¨ ì²˜ë¦¬ ì‹œ 50-100ms

## ğŸ—ï¸ í•´ê²° ë°©ì•ˆ

### Worker Pool íŒ¨í„´ ë„ì…

#### ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Git Diff (Raw String)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  splitFileDiffs()    â”‚  â† íŒŒì¼ ë‹¨ìœ„ ë¶„ë¦¬
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   File Diff Queue    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Worker 1 â”‚ â”‚ Worker 2 â”‚  â† ë³‘ë ¬ íŒŒì‹± (2-8 workers)
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ParsedFile Queue     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  convertParsedFiles()  â”‚  â† íƒ€ì… ë³€í™˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   DiffResult          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì£¼ìš” ì»´í¬ë„ŒíŠ¸

##### 1. Worker Pool (`internal/worker/pool.go`)
```go
type WorkerPool struct {
    workers    int              // ì›Œì»¤ ìˆ˜ (2-8)
    input      chan FileDiff    // ì‘ì—… í
    output     chan ParsedFile  // ê²°ê³¼ í
    wg         sync.WaitGroup  // ë™ê¸°í™”
    fileCount  int              // íŒŒì¼ ìˆ˜
}
```

##### 2. ë™ì  Worker ìˆ˜ ì¡°ì ˆ
```go
func GetOptimalWorkerCount(fileCount int) int {
    if fileCount <= 10 {
        return 2   // ì†Œê·œëª¨
    } else if fileCount <= 50 {
        return 4   // ì¤‘ê·œëª¨
    } else if fileCount <= 100 {
        return 6   // ëŒ€ê·œëª¨
    }
    return 8       // ì´ˆëŒ€í˜•
}
```

##### 3. ì¡°ê±´ë¶€ ë³‘ë ¬í™”
```go
if len(fileDiffs) <= 5 {
    // ì†Œê·œëª¨: ìˆœì°¨ ì²˜ë¦¬ (ì˜¤ë²„í—¤ë“œ ë°©ì§€)
    return nil
}
// ëŒ€ê·œëª¨: ë³‘ë ¬ ì²˜ë¦¬
```

## ğŸ”§ êµ¬í˜„ ìƒì„¸

### ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ í•´ê²°

#### ë¬¸ì œ
ì´ˆê¸° ì„¤ê³„ì—ì„œ `worker` íŒ¨í‚¤ì§€ê°€ `git` íŒ¨í‚¤ì§€ë¥¼ importí•˜ì—¬ ìˆœí™˜ ì°¸ì¡° ë°œìƒ:
```
git â†’ worker â†’ git âŒ
```

#### í•´ê²°
`worker` íŒ¨í‚¤ì§€ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ë§Œë“¤ì–´ ìˆœí™˜ ì°¸ì¡° ì œê±°:
```
git â†’ worker (ë…ë¦½)
worker â†’ ParsedFile (ìì²´ íƒ€ì…)
```

```go
// worker/pool.go
type ParsedFile struct {
    Path      string
    FileType  int    // 0: source, 1: test, 2: doc, 3: config
    IsNew     bool
    IsDeleted bool
    Changes   string
}

// git/diff.go
func convertParsedFiles(pf []worker.ParsedFile) []FileChange {
    // ë³€í™˜ ë¡œì§
}
```

### íŒŒì¼ íƒ€ì… ë¶„ë¥˜ ë¡œì§ ë³µì œ
`worker.ClassifyFileType()`ëŠ” `git.ClassifyFileType()`ì™€ ë™ì¼í•œ ë¡œì§ì„ ê°€ì§€ì§€ë§Œ ìˆœí™˜ ì°¸ì¡°ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë…ë¦½ì ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“Š ì„±ëŠ¥ ì¸¡ì •

### ê¸°ëŒ€ íš¨ê³¼

| íŒŒì¼ ìˆ˜ | ìˆœì°¨ ì²˜ë¦¬ | ë³‘ë ¬ ì²˜ë¦¬ | í–¥ìƒìœ¨ |
|---------|----------|----------|--------|
| < 5     | ~10ms    | ~10ms    | -      |
| 5-10    | ~20ms    | ~15ms    | 25%    |
| 10-50   | ~100ms   | ~70ms    | 30%    |
| 50-100  | ~200ms   | ~100ms   | 50%    |
| 100+    | ~500ms   | ~250ms   | 50%    |

### ì‹¤ì œ ì¸¡ì • ì˜ˆì‹œ
```bash
# í…ŒìŠ¤íŠ¸ í™˜ê²½: MacBook Pro M2, 8ì½”ì–´
# í…ŒìŠ¤íŠ¸ ëŒ€ìƒ: 75 íŒŒì¼ ì»¤ë°‹

# ìˆœì°¨ ì²˜ë¦¬
$ time git-ai-commit (v0.2.0)
real    0.45s
user    0.38s
sys     0.07s

# ë³‘ë ¬ ì²˜ë¦¬
$ time git-ai-commit (v0.3.0)
real    0.23s
user    0.41s
sys     0.09s

# í–¥ìƒìœ¨: 48.9%
```

## ğŸ“ ì½”ë“œ ë³€ê²½

### ì‹ ê·œ íŒŒì¼

#### `internal/worker/pool.go`
- Worker Pool êµ¬í˜„
- ë³‘ë ¬ diff íŒŒì‹± ë¡œì§
- íŒŒì¼ íƒ€ì… ë¶„ë¥˜ (ë…ë¦½)

### ìˆ˜ì • íŒŒì¼

#### `internal/git/diff.go`
```go
// ì´ì „
result, err := ParseDiff(rawDiff)

// ì´í›„
parsedFiles, err := worker.ParseDiffParallel(rawDiff, workers)
if parsedFiles != nil {
    result.Files = convertParsedFiles(parsedFiles)
} else {
    result, err = ParseDiff(rawDiff)
}
```

### ì¶”ê°€ í•¨ìˆ˜
- `estimateFileCount(diff string) int`
- `convertParsedFiles(pf []worker.ParsedFile) []FileChange`

## ğŸ› ì´ìŠˆ í•´ê²°

### 1. Import ì˜¤ë¥˜
**ë¬¸ì œ**: `could not import git-ai-commit/internal/worker`

**ì›ì¸**: Go ëª¨ë“ˆ ìºì‹œ ì˜¤ë¥˜

**í•´ê²°**:
```bash
go clean -modcache
go mod tidy
go build
```

### 2. ìˆœí™˜ ì°¸ì¡°
**ë¬¸ì œ**: `git â†’ worker â†’ git` ìˆœí™˜

**í•´ê²°**: `worker` íŒ¨í‚¤ì§€ ë…ë¦½í™”, `ParsedFile` íƒ€ì… ë„ì…

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### ì‚¬ìš©ì ê´€ì 
ì´ ë³€ê²½ì€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë‚˜ APIì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤:

```bash
# ê¸°ì¡´ê³¼ ë™ì¼
git-ai-commit -detail high -lang ko
```

### ê°œë°œì ê´€ì 
ìƒˆë¡œìš´ worker íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```go
import "git-ai-commit/internal/worker"

// ë³‘ë ¬ íŒŒì‹±
files, err := worker.ParseDiffParallel(diff, 4)
```

## ğŸ“‹ í…ŒìŠ¤íŠ¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```bash
go test ./internal/worker/...
```

### í†µí•© í…ŒìŠ¤íŠ¸
```bash
# ë¹Œë“œ
go build -o git-ai-commit

# ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
./git-ai-commit --help

# ì‹¤ì œ ì‚¬ìš©
git add .
git-ai-commit -detail high -lang ko
```

## ğŸ“ êµí›ˆ

1. **ì„±ëŠ¥ ìµœì í™”**: ë³‘ë ¬ ì²˜ë¦¬ëŠ” I/O ë°”ìš´ë“œ ì‘ì—…ì—ì„œ í° íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŒ
2. **ìˆœí™˜ ì°¸ì¡°**: íŒ¨í‚¤ì§€ ì˜ì¡´ì„±ì„ ì‹ ì¤‘í•˜ê²Œ ì„¤ê³„í•´ì•¼ í•¨
3. **ë™ì  ì¡°ì ˆ**: ì‘ì—…ëŸ‰ì— ë”°ë¼ ë¦¬ì†ŒìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ í• ë‹¹í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì 
4. **ì˜¤ë²„í—¤ë“œ ê³ ë ¤**: ì†Œê·œëª¨ ì‘ì—…ì—ì„œëŠ” ë³‘ë ¬ ì²˜ë¦¬ì˜ ì˜¤ë²„í—¤ë“œê°€ ì˜¤íˆë ¤ ì„±ëŠ¥ ì €í•˜ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŒ

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### v1.4.0 ì˜ˆì •
- [ ] AI ì¶”ë¡  ì •í™•ì„± ê°œì„ 
- [ ] ì»¤ë°‹ íƒ€ì… ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜ ê°œì„ 
- [ ] Scope ì¶”ë¡  ë¡œì§ ìµœì í™”

### í–¥í›„ ê°œì„ 
- [ ] Worker ìˆ˜ë¥¼ CPU ì½”ì–´ ìˆ˜ì— ë§ê²Œ ìë™ ì¡°ì ˆ
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
- [ ] ëŒ€ê·œëª¨ ì»¤ë°‹ì—ì„œì˜ ì¶”ê°€ ì„±ëŠ¥ ìµœì í™”

## ğŸ“š ì°¸ê³  ìë£Œ

- [Go Concurrency Patterns](https://go.dev/doc/effective_go#concurrency)
- [Worker Pool Pattern](https://gobyexample.com/worker-pools)
- [Go Modules](https://go.dev/ref/mod)