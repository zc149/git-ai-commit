# v1.4.0: ë©”ì‹œì§€ ë°˜ë³µ ë° ìºì‹œ ê¸°ëŠ¥

## ê°œìš”

v1.4.0ì—ì„œëŠ” ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ì»¤ë°‹ ë©”ì‹œì§€ ë°˜ë³µ ìƒì„± ê¸°ëŠ¥ê³¼ ìºì‹œ ì‹œìŠ¤í…œì„ ë„ì…í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ AI ì¶”ì²œ ë©”ì‹œì§€ì— ë§Œì¡±í•˜ì§€ ì•Šì„ ë•Œ ìƒˆë¡œìš´ í›„ë³´ë¥¼ ìƒì„±í•˜ê³ , ë§Œì¡±í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì°¾ìœ¼ë©´ ì´ë¥¼ ìºì‹œí•˜ì—¬ ë‹¤ìŒì— ê°™ì€ ì‘ì—…ì„ í•  ë•Œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë™ê¸°

### ë¬¸ì œ 1: AI ì¶”ì²œì´ ë§ˆìŒì— ì•ˆ ë“¤ ë•Œ
- ê¸°ì¡´ì—ëŠ” ì²« ë²ˆì§¸ ì¶”ì²œë§Œ ì œê³µë˜ì—ˆìŒ
- ë§ˆìŒì— ì•ˆ ë“¤ë©´ `c`ë¥¼ ëˆŒëŸ¬ ì§ì ‘ ì…ë ¥í•´ì•¼ í•¨
- ì—¬ëŸ¬ ë²ˆ ì‹œë„í•˜ë ¤ë©´ ëª…ë ¹ì–´ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•¨

### ë¬¸ì œ 2: ë°˜ë³µ ì‘ì—…ì˜ ë¹„íš¨ìœ¨ì„±
- ê°™ì€ íƒ€ì…ì˜ ì»¤ë°‹ì„ ë°˜ë³µí•  ë•Œë§ˆë‹¤ ê°™ì€ ë©”ì‹œì§€ë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ì—¬ëŸ¬ ë²ˆ í›„ë³´ë¥¼ í™•ì¸í•´ì•¼ í•¨
- ì˜ˆ: ë²„ê·¸ ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜ì • íŒ¨í„´ì´ ë°˜ë³µë  ë•Œ

## í•´ê²° ë°©ì•ˆ

### 1. ì¬ì¶”ì²œ ê¸°ëŠ¥ (Regenerate)
- í›„ë³´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  ë§ˆìŒì— ì•ˆ ë“¤ë©´ `r` í‚¤ë¥¼ ëˆŒëŸ¬ ìƒˆë¡œìš´ í›„ë³´ ìƒì„±
- íšŸìˆ˜ ì œí•œ ì—†ì´ ê³„ì† ìƒˆë¡œìš´ í›„ë³´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ

### 2. ìºì‹œ ì‹œìŠ¤í…œ
- ì„ íƒí•œ ë©”ì‹œì§€ë¥¼ diff hash ê¸°ë°˜ìœ¼ë¡œ ì €ì¥
- ê°™ì€ diffë¡œ ë‹¤ì‹œ ì‹œë„í•  ë•Œ ìºì‹œëœ ë©”ì‹œì§€ë¥¼ `p` í‚¤ë¡œ ì„ íƒ ê°€ëŠ¥
- ìºì‹œ ìœ„ì¹˜: `~/.git-ai-commit/cache.json`

### 3. ì»¨íŠ¸ë¡¤ í”Œë¡œìš° ê°œì„ 
- Goì˜ ì—ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•œ ì œì–´ íë¦„
- `RegenerateError`: ì¬ì¶”ì²œ ìš”ì²­ì„ ë‚˜íƒ€ë‚´ëŠ” ì—ëŸ¬
- `UsePrevMessageError`: ì´ì „ ë©”ì‹œì§€ ì‚¬ìš© ìš”ì²­ì„ ë‚˜íƒ€ë‚´ëŠ” ì—ëŸ¬

## ì„¤ê³„ ê²°ì •ì‚¬í•­

### Diff Hash ê¸°ë°˜ ìºì‹±

**ê²°ì •**: ìºì‹œ í‚¤ë¡œ diff hash ì‚¬ìš©

**ì´ìœ **:
- **ì•ˆì „ì„±**: diff ë‚´ìš©ì´ ê°™ìœ¼ë©´ ë™ì¼í•œ ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•´ë„ ì•ˆì „
- **ì •í™•ì„±**: íŒŒì¼ ì´ë¦„ë§Œìœ¼ë¡œëŠ” ë³€ê²½ ë‚´ìš©ì˜ ì¼ì¹˜ë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŒ
- **ìœ ì—°ì„±**: ê°™ì€ íŒŒì¼ì´ë¼ë„ ë³€ê²½ ë‚´ìš©ì´ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ìºì‹œë¡œ ì €ì¥

**êµ¬í˜„**:
```go
func CalculateDiffHash(diff string) string {
    hash := sha256.New()
    hash.Write([]byte(diff))
    return hex.EncodeToString(hash.Sum(nil))
}
```

### ì—ëŸ¬ ê¸°ë°˜ ì œì–´ íë¦„

**ê²°ì •**: ì»¤ìŠ¤í…€ ì—ëŸ¬ íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ ì œì–´ íë¦„ ì²˜ë¦¬

**ì´ìœ **:
- Goì˜ ì—ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í™œìš©
- ì—ëŸ¬ íƒ€ì… ì²´í¬ë¥¼ í†µí•œ ëª…í™•í•œ ì œì–´ íë¦„
- ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

**êµ¬í˜„**:
```go
// ì¬ì¶”ì²œ ì—ëŸ¬
type RegenerateError struct{}
func (e *RegenerateError) Error() string {
    return "regenerate requested"
}

// ì´ì „ ë©”ì‹œì§€ ì‚¬ìš© ì—ëŸ¬
type UsePrevMessageError struct {
    Message string
}
func (e *UsePrevMessageError) Error() string {
    return "use previous message"
}

// ì‚¬ìš© ì˜ˆì‹œ
if _, ok := err.(*RegenerateError); ok {
    // ìƒˆë¡œìš´ í›„ë³´ ìƒì„±
}
if prevMsgErr, ok := err.(*ui.UsePrevMessageError); ok {
    selectedMessage = prevMsgErr.Message
}
```

### ìºì‹œ ì €ì¥ì†Œ

**ê²°ì •**: íŒŒì¼ ì‹œìŠ¤í…œì— JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥

**ì´ìœ **:
- **ë‹¨ìˆœì„±**: ë³„ë„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ì˜ì¡´ì„± ë¶ˆí•„ìš”
- **ì´ì‹ì„±**: í™ˆ ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë³„ ìºì‹œ ê´€ë¦¬
- **íˆ¬ëª…ì„±**: JSONìœ¼ë¡œ ì‰½ê²Œ í™•ì¸í•˜ê³  ìˆ˜ì • ê°€ëŠ¥

**êµ¬í˜„**:
```go
type CacheManager struct {
    cachePath string
}

type CacheData struct {
    DiffHash string    `json:"diffHash"`
    Message  string    `json:"message"`
    Timestamp time.Time `json:"timestamp"`
}
```

## êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. ìºì‹œ ë§¤ë‹ˆì € (`internal/cache/cache.go`)

**ì£¼ìš” ê¸°ëŠ¥**:
- `NewCacheManager()`: ìºì‹œ ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ìƒì„±
- `Load(diffHash)`: diff hashë¡œ ìºì‹œëœ ë©”ì‹œì§€ ë¡œë“œ
- `Save(diffHash, message)`: ì„ íƒí•œ ë©”ì‹œì§€ë¥¼ ìºì‹œì— ì €ì¥

**ìºì‹œ êµ¬ì¡°**:
```json
{
  "entries": [
    {
      "diffHash": "abc123...",
      "message": "feat: add feature",
      "timestamp": "2024-02-09T17:00:00Z"
    }
  ]
}
```

### 2. UI í™•ì¥ (`internal/ui/selector.go`)

**ìƒˆë¡œìš´ ì˜µì…˜**:
- `r) Regenerate candidates`: ìƒˆë¡œìš´ í›„ë³´ ìƒì„± ìš”ì²­
- `p) Use previous message`: ìºì‹œëœ ì´ì „ ë©”ì‹œì§€ ì‚¬ìš© (ì´ì „ ë©”ì‹œì§€ê°€ ìˆì„ ë•Œë§Œ)

**ë©”ì‹œì§€ í¬ë§·íŒ…**:
```go
// ì´ì „ ë©”ì‹œì§€ê°€ ìˆì„ ë•Œ
p) ì´ì „ ë©”ì‹œì§€ ì‚¬ìš© (feat: add feature)
1) feat: add feature
2) feat: implement feature
c) Custom input
r) Regenerate candidates
q) Quit

Select (p/1-2 or c/r/q): 
```

### 3. ë©”ì¸ ë£¨í”„ ìˆ˜ì • (`cmd/root.go`)

**ì¬ì¶”ì²œ ë£¨í”„**:
```go
for {
    selectedMessage, err = selector.Select(messages, prevMessage)
    
    if err != nil {
        // ì¬ì¶”ì²œ ìš”ì²­
        if _, ok := err.(*ui.RegenerateError); ok {
            messages, err = generator.Generate(diffResult, detail, lang)
            continue
        }
        
        // ì´ì „ ë©”ì‹œì§€ ì‚¬ìš©
        if prevMsgErr, ok := err.(*ui.UsePrevMessageError); ok {
            selectedMessage = prevMsgErr.Message
            break
        }
        
        // ê·¸ ì™¸ ì—ëŸ¬ (ì¢…ë£Œ ë“±)
        return err
    }
    
    // ì •ìƒ ì„ íƒ
    break
}
```

**ìºì‹œ í†µí•©**:
```go
// ìºì‹œ ë§¤ë‹ˆì € ì´ˆê¸°í™”
cacheManager, err := cache.NewCacheManager()
if err != nil {
    return fmt.Errorf("ìºì‹œ ë§¤ë‹ˆì € ìƒì„± ì‹¤íŒ¨: %w", err)
}

// ì´ì „ ë©”ì‹œì§€ ë¡œë“œ
diffHash := git.CalculateDiffHash(diffResult.RawDiff)
cachedData, err := cacheManager.Load(diffHash)
var prevMessage string
if err == nil && cachedData != nil {
    prevMessage = cachedData.Message
}

// ì„ íƒí•œ ë©”ì‹œì§€ ìºì‹œì— ì €ì¥
if err := cacheManager.Save(diffHash, selectedMessage); err != nil {
    fmt.Println("âš ï¸ ì»¤ë°‹ ë©”ì‹œì§€ ìºì‹œ ì €ì¥ ì‹¤íŒ¨")
}
```

### 4. Diff Hash ê³„ì‚° (`internal/git/diff.go`)

**í•¨ìˆ˜ ì¶”ê°€**:
```go
func CalculateDiffHash(diff string) string {
    hash := sha256.New()
    hash.Write([]byte(diff))
    return hex.EncodeToString(hash.Sum(nil))
}
```

## ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: í›„ë³´ê°€ ë§ˆìŒì— ì•ˆ ë“¤ ë•Œ

1. `git-ai-commit` ì‹¤í–‰
2. AIê°€ 3ê°œì˜ í›„ë³´ ë©”ì‹œì§€ ìƒì„±
3. í›„ë³´ë“¤ì´ ë§ˆìŒì— ì•ˆ ë“¤ìŒ â†’ `r` ì…ë ¥
4. ìƒˆë¡œìš´ í›„ë³´ 3ê°œ ìƒì„±
5. ì—¬ì „íˆ ë§ˆìŒì— ì•ˆ ë“¤ìŒ â†’ `r` ì…ë ¥
6. ìƒˆë¡œìš´ í›„ë³´ 3ê°œ ìƒì„±
7. ë§ˆìŒì— ë“œëŠ” í›„ë³´ ë°œê²¬ â†’ `1` ì…ë ¥
8. ì»¤ë°‹ ì™„ë£Œ

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë°˜ë³µ ì‘ì—… íš¨ìœ¨í™”

1. ë²„ê·¸ ìˆ˜ì • ì‘ì—… ìˆ˜í–‰ (íŒ¨í„´: íŒŒì¼ ë³€ê²½ + í…ŒìŠ¤íŠ¸ ìˆ˜ì •)
2. `git-ai-commit` ì‹¤í–‰
3. í›„ë³´ í™•ì¸ í›„ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ë©”ì‹œì§€ ì„ íƒ â†’ `2` ì…ë ¥
4. ì»¤ë°‹ ì™„ë£Œ, ë©”ì‹œì§€ ìºì‹œì— ì €ì¥
5. ë‹¤ë¥¸ ë²„ê·¸ ìˆ˜ì • ì‘ì—… ìˆ˜í–‰ (ê°™ì€ íŒ¨í„´)
6. `git-ai-commit` ì‹¤í–‰
7. `p) ì´ì „ ë©”ì‹œì§€ ì‚¬ìš© (fix: resolve bug)` ì˜µì…˜ í‘œì‹œ
8. `p` ì…ë ¥í•˜ì—¬ ì´ì „ ë©”ì‹œì§€ ì¬ì‚¬ìš©
9. ì»¤ë°‹ ì™„ë£Œ

## ì¥ì 

1. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ë§ˆìŒì— ì•ˆ ë“œëŠ” í›„ë³´ë¥¼ ê³„ì† ì¬ìƒì„± ê°€ëŠ¥
2. **ì‹œê°„ ì ˆì•½**: ë°˜ë³µì ì¸ ì‘ì—…ì—ì„œ ì´ì „ ë©”ì‹œì§€ë¥¼ ì¬ì‚¬ìš©
3. **ìœ ì—°ì„±**: íšŸìˆ˜ ì œí•œ ì—†ì´ ì›í•˜ëŠ” ë§Œí¼ í›„ë³´ë¥¼ ìƒì„±
4. **ì•ˆì „ì„±**: diff hash ê¸°ë°˜ ìºì‹±ìœ¼ë¡œ ì˜ëª»ëœ ë©”ì‹œì§€ ì¬ì‚¬ìš© ë°©ì§€
5. **ë‹¨ìˆœì„±**: íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ìºì‹œë¡œ ë³µì¡í•œ ì˜ì¡´ì„± ì—†ìŒ

## í–¥í›„ ê°œì„  ê°€ëŠ¥ì„±

1. **ìºì‹œ ë§Œë£Œ**: ì˜¤ë˜ëœ ìºì‹œ ìë™ ì‚­ì œ ê¸°ëŠ¥
2. **ìºì‹œ ê´€ë¦¬**: ìºì‹œ í™•ì¸ ë° ì‚­ì œ ëª…ë ¹ì–´
3. **ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬**: ì„ íƒí–ˆë˜ ëª¨ë“  ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ í™•ì¸
4. **ì¦ê²¨ì°¾ê¸°**: ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ íŒ¨í„´ ì €ì¥
5. **ìºì‹œ ê³µìœ **: íŒ€ ë‹¨ìœ„ë¡œ ìºì‹œ ê³µìœ  (Git ê¸°ë°˜)

## í…ŒìŠ¤íŠ¸

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

1. **ì¬ì¶”ì²œ ê¸°ëŠ¥**
   - í›„ë³´ í™•ì¸ í›„ `r` ì…ë ¥
   - ìƒˆë¡œìš´ í›„ë³´ ìƒì„± í™•ì¸
   - ì—¬ëŸ¬ ë²ˆ ë°˜ë³µ í™•ì¸

2. **ìºì‹œ ê¸°ëŠ¥**
   - ë©”ì‹œì§€ ì„ íƒ í›„ ì»¤ë°‹
   - ê°™ì€ diffë¡œ ë‹¤ì‹œ ì‹œë„
   - `p) ì´ì „ ë©”ì‹œì§€ ì‚¬ìš©` ì˜µì…˜ í™•ì¸
   - `p` ì…ë ¥ í›„ ìºì‹œëœ ë©”ì‹œì§€ ì‚¬ìš© í™•ì¸

3. **ìºì‹œ ë¬´íš¨í™”**
   - diff ë³€ê²½ í›„ `git-ai-commit` ì‹¤í–‰
   - `p` ì˜µì…˜ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸

4. **ì˜µì…˜ ì¡°í•©**
   - ì¬ì¶”ì²œ í›„ ì´ì „ ë©”ì‹œì§€ ì‚¬ìš©
   - ì§ì ‘ ì…ë ¥ í›„ ìºì‹œ í™•ì¸

## ë²„ê·¸ ìˆ˜ì •

v0.4.0 ê°œë°œ ê³¼ì •ì—ì„œ ë°œê²¬í•˜ê³  ìˆ˜ì •í•œ ë²„ê·¸ë“¤ì…ë‹ˆë‹¤.

### ë²„ê·¸ 1: detail ê¸°ë³¸ê°’ì´ mediumìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ë¬¸ì œ

**ë¬¸ì œ**: `-detail` ì˜µì…˜ ì—†ì´ ì‹¤í–‰í•  ë•Œ ê¸°ë³¸ê°’ì´ `low`ê°€ ì•„ë‹Œ `medium`ìœ¼ë¡œ í‘œì‹œë¨

**ì›ì¸**: `cmd/root.go`ì—ì„œ ê¸°ë³¸ê°’ì„ `"medium"`ìœ¼ë¡œ ì„¤ì •

**ìˆ˜ì •**:
```go
// ìˆ˜ì • ì „
var detail string
cmd.Flags().StringVar(&detail, "detail", "medium", "detail level: low, medium, high")

// ìˆ˜ì • í›„
var detail string
cmd.Flags().StringVar(&detail, "detail", "low", "detail level: low, medium, high")
```

---

### ë²„ê·¸ 2: high ë””í…Œì¼ ë ˆë²¨ì—ì„œ ì§§ì€ ë©”ì‹œì§€ê°€ ë‚˜ì˜¤ëŠ” ë¬¸ì œ

**ë¬¸ì œ**: `detail` ë ˆë²¨ì„ `high`ë¡œ ì„¤ì •í•´ë„ ì§§ì€ í•œ ì¤„ ë©”ì‹œì§€ë§Œ í‘œì‹œë¨

**ì›ì¸**: `internal/llm/utils.go`ì˜ `parseCommitMessages()` í•¨ìˆ˜ê°€ ë²ˆí˜¸ë¡œ ì‹œì‘í•˜ëŠ” ì²« ë²ˆì§¸ ì¤„ë§Œ íŒŒì‹±í•˜ê³ , ë‚˜ë¨¸ì§€ ë‚´ìš©ì€ ë¬´ì‹œ

**ìˆ˜ì •**:
```go
// ìˆ˜ì • ì „: ì²« ë²ˆì§¸ ì¤„ë§Œ íŒŒì‹±
msg := removeNumberPrefix(line)
if msg != "" {
    messages = append(messages, msg)
}

// ìˆ˜ì • í›„: ë‹¤ìŒ ë²ˆí˜¸ë‚˜ ë¹ˆ ì¤„ì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ê³„ì† ìˆ˜ì§‘
msg := removeNumberPrefix(line)
i++
for i < len(lines) {
    nextLine := trimWhitespace(lines[i])
    
    // ë¹ˆ ì¤„ì´ê±°ë‚˜ ë‹¤ìŒ ë²ˆí˜¸ê°€ ë‚˜ì˜¤ë©´ ì¤‘ì§€
    if nextLine == "" || isNumberedFormat(nextLine) {
        break
    }
    
    // ë“¤ì—¬ì“°ê¸°ëœ ì¤„ì´ë‚˜ ì—°ì†ëœ ë‚´ìš©ì„ ì¶”ê°€
    if msg != "" {
        msg += "\n" + nextLine
    } else {
        msg = nextLine
    }
    
    i++
}

if msg != "" {
    messages = append(messages, msg)
}
```

---

### ë²„ê·¸ 3: featë¥¼ buildë¡œ ì˜ëª» ë¶„ë¥˜í•˜ëŠ” ë¬¸ì œ

**ë¬¸ì œ**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ (ìƒˆ ì†ŒìŠ¤ íŒŒì¼ 8ê°œ)ì¸ë° `build`ë¡œ ë¶„ë¥˜ë¨

**ì˜ˆì‹œ**:
```
feat: add api-proxy-backed plugin  (ì‚¬ìš©ìê°€ ì§ì ‘ ì‘ì„±)
â†’ ì‹œìŠ¤í…œ ì¶”ì²œ: build(app-config.local.yaml, app-config.yaml, packages, plugins, yarn.lock)
```

**ì›ì¸**: 
- `yarn.lock`ì´ ì˜ì¡´ì„± íŒŒì¼ë¡œ ê°ì§€ë˜ì–´ `build`ì— +5 ì  ë¶€ì—¬
- ìƒˆ ì†ŒìŠ¤ íŒŒì¼ì´ 3ê°œ ì´ìƒì´ì–´ë„ `feat` ì ìˆ˜ê°€ ì¶©ë¶„íˆ ë†’ì§€ ì•ŠìŒ
- ì˜ì¡´ì„± íŒŒì¼ì´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ `build`ì— ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ëŠ” ë¡œì§ ë•Œë¬¸ì— `feat`ì™€ ê²½ìŸ

**ìˆ˜ì •**:
```go
// 1. ìƒˆ ì†ŒìŠ¤ íŒŒì¼ì´ 3ê°œ ì´ìƒì¼ ë•Œ feat ì ìˆ˜ ì¦ê°€
if newSourceFileCount >= 3 {
    typeScore["feat"] += 20  // ìˆ˜ì • ì „: 15
}

// 2. ì˜ì¡´ì„± íŒŒì¼ì´ ìˆë”ë¼ë„ ìƒˆ ì†ŒìŠ¤ íŒŒì¼ì´ ë§ìœ¼ë©´ build ì ìˆ˜ ê°ì†Œ
// (ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ì— ìˆ˜ë°˜ëœ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ì¸ ê²½ìš°)
if hasDependencyFile && newSourceFileCount >= 3 {
    typeScore["build"] -= 10  // ìƒˆë¡œìš´ ë¡œì§
    typeScore["feat"] += 10  // ìƒˆë¡œìš´ ë¡œì§
}
```

**íš¨ê³¼**:
- ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ì— ìˆ˜ë°˜ëœ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ëŠ” `build` ëŒ€ì‹  `feat`ë¡œ ë¶„ë¥˜
- ì˜ì¡´ì„± íŒŒì¼ë§Œ ë‹¨ë…ìœ¼ë¡œ ë³€ê²½ëœ ê²½ìš°ì—ëŠ” ì—¬ì „íˆ `build`ë¡œ ë¶„ë¥˜

---

### ë²„ê·¸ 4: scopeì— ëª¨ë“  íŒŒì¼ ì´ë¦„ì´ ë‚˜ì˜¤ëŠ” ë¬¸ì œ

**ë¬¸ì œ**: ì†ŒìŠ¤ íŒŒì¼ì´ ì—¬ëŸ¬ ë””ë ‰í† ë¦¬ì— í©ì–´ì ¸ ìˆì„ ë•Œ scopeì— ëª¨ë“  ìµœìƒìœ„ ë””ë ‰í† ë¦¬ ì´ë¦„ì´ ë‚˜ì˜´

**ì˜ˆì‹œ**:
```
ğŸ“Š Recommended commit type: build
   Recommended scope: [app-config.local.yaml app-config.yaml packages plugins yarn.lock]
```

**ì›ì¸**: 
- `InferScopes()` í•¨ìˆ˜ê°€ ëª¨ë“  ë””ë ‰í† ë¦¬ë¥¼ ì§‘ê³„
- ì„¤ì • íŒŒì¼, í…ŒìŠ¤íŠ¸ íŒŒì¼ ë“±ì˜ ë””ë ‰í† ë¦¬ë„ í¬í•¨ë˜ì–´ ê³¼ë„í•œ ê²°ê³¼

**ìˆ˜ì •**: `InferScopes()` í•¨ìˆ˜ ì™„ì „ ì¬ì‘ì„±

```go
// ìˆ˜ì • ì „: ëª¨ë“  íŒŒì¼ì˜ ë””ë ‰í† ë¦¬ ì§‘ê³„
for _, file := range files {
    path := file.Path
    parts := strings.Split(filepath.Clean(path), string(filepath.Separator))
    
    for i := 1; i < len(parts); i++ {
        dir := strings.Join(parts[:i], string(filepath.Separator))
        dirCounts[dir]++
    }
    
    // ì„¤ì • íŒŒì¼ë„ ë””ë ‰í† ë¦¬ ë¶„ë¥˜ì— í¬í•¨
    if file.FileType == FileTypeSource {
        sourceDirs[dir] = true
    } else if file.FileType == FileTypeConfig {
        configDirs[dir] = true
    }
}

// ìˆ˜ì • í›„: ì†ŒìŠ¤ íŒŒì¼ë§Œ ì§‘ê³„
topLevelDirs := make(map[string]int)
for _, file := range files {
    if file.FileType != FileTypeSource {
        continue  // ì†ŒìŠ¤ íŒŒì¼ë§Œ ì²˜ë¦¬
    }
    
    path := file.Path
    parts := strings.Split(filepath.Clean(path), string(filepath.Separator))
    if len(parts) > 0 {
        topDir := parts[0]
        topLevelDirs[topDir]++
    }
}

// 3ê°œ ì´ìƒì˜ ë‹¤ë¥¸ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì— ì†ŒìŠ¤ íŒŒì¼ì´ ìˆìœ¼ë©´ "multiple" ì‚¬ìš©
if commonPrefix != "" {
    scopes = append(scopes, simplifyScopeName(commonPrefix))
} else if len(topLevelDirs) >= 3 {
    scopes = append(scopes, "multiple")
} else {
    // ì†ŒìŠ¤ íŒŒì¼ì´ ê°€ì¥ ë§ì€ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ í•˜ë‚˜ë§Œ ì„ íƒ
    maxCount := 0
    var primaryDir string
    for dir, count := range topLevelDirs {
        if count > maxCount {
            maxCount = count
            primaryDir = dir
        }
    }
    if primaryDir != "" {
        scopes = append(scopes, simplifyScopeName(primaryDir))
    }
}
```

**íš¨ê³¼**:
- ì„¤ì • íŒŒì¼, í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ scope ì¶”ë¡ ì—ì„œ ì œì™¸
- ì†ŒìŠ¤ íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë§Œ ê³ ë ¤
- 3ê°œ ì´ìƒì˜ ë‹¤ë¥¸ ë””ë ‰í† ë¦¬ì— ì†ŒìŠ¤ íŒŒì¼ì´ ìˆìœ¼ë©´ "multiple" ì‚¬ìš©
- ê·¸ ì™¸ì—ëŠ” ì†ŒìŠ¤ íŒŒì¼ì´ ê°€ì¥ ë§ì€ ë””ë ‰í† ë¦¬ í•˜ë‚˜ë§Œ scopeë¡œ ì œê³µ

---

### ë²„ê·¸ 5: ëŒ€ê·œëª¨ ì»¤ë°‹ì—ì„œ Deadlock ë°œìƒ (ì¹˜ëª…ì )

**ë¬¸ì œ**: 17ê°œ ì´ìƒ íŒŒì¼ì´ í¬í•¨ëœ ì»¤ë°‹ì—ì„œ deadlock ë°œìƒ

**ì—ëŸ¬ ë©”ì‹œì§€**:
```
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [sync.WaitGroup.Wait]:
sync.(*WaitGroup).Wait(0x1400010a918)
    internal/worker/pool.go:120

goroutine 40 [chan send]:
git-ai-commit/internal/worker.(*WorkerPool).worker(0x1400010a900, 0x0?)
    internal/worker/pool.go:60

goroutine 41-43 [chan send]:
(ë™ì¼í•œ ìƒíƒœ)
```

**ì›ì¸**: Producer-Consumer íŒ¨í„´ ìœ„ë°˜

**ìƒí™© ë¶„ì„**:
1. ë©”ì¸ goroutineì´ ì‘ì—…ì„ `input` ì±„ë„ì— ì „ì†¡
   - ë²„í¼ í¬ê¸°: `workers*2` (ì˜ˆ: 4 workers â†’ ë²„í¼ 8)
   - 9ë²ˆì§¸ ì‘ì—… ì „ì†¡ ì‹œ ë²„í¼ê°€ ê°€ë“ ì°¨ì„œ **ë¸”ë¡ë¨**

2. Worker goroutinesë“¤ì´ `output` ì±„ë„ì— ê²°ê³¼ ì „ì†¡ ì‹œë„
   - ë²„í¼ í¬ê¸°: `workers*2` (ì˜ˆ: 4 workers â†’ ë²„í¼ 8)
   - ì›Œì»¤ë“¤ì´ ê³„ì† ê²°ê³¼ë¥¼ ìƒì„±í•˜ë‹¤ê°€ `output` ë²„í¼ë„ ê°€ë“ ì°¸
   - ì›Œì»¤ë“¤ì´ **`output` ì „ì†¡ì—ì„œ ë¸”ë¡ë¨**

3. **Deadlock ë°œìƒ**:
   - ë©”ì¸ goroutine: `input` ì „ì†¡ ëŒ€ê¸° (ë²„í¼ ê½‰ ì°¸)
   - Worker goroutines: `output` ì „ì†¡ ëŒ€ê¸° (ë²„í¼ ê½‰ ì°¸)
   - ì›Œì»¤ë“¤ì´ `input`ì—ì„œ ì½ì§€ ëª»í•˜ë¯€ë¡œ ë©”ì¸ goroutineì˜ ì‘ì—…ë„ ì²˜ë¦¬ë˜ì§€ ì•ŠìŒ

**ìˆ˜ì • ì „ ì½”ë“œ**:
```go
func ParseDiffParallel(diff string, workers int) ([]ParsedFile, error) {
    // ...
    pool := NewWorkerPool(workers)
    pool.Start()
    
    // 1. ì‘ì—… ì œì¶œ (ë©”ì¸ goroutineì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ)
    for i, fileDiff := range fileDiffs {
        pool.Submit(fileDiff, i)  // â† ì—¬ê¸°ì„œ ë¸”ë¡ë  ìˆ˜ ìˆìŒ
    }
    
    // 2. ê²°ê³¼ ìˆ˜ì§‘ goroutine ì‹œì‘
    resultChan := make(chan []ParsedFile, 1)
    go func() {
        results := pool.Results()
        resultChan <- results
    }()
    
    // 3. ì‘ì—… ì™„ë£Œ ëŒ€ê¸°
    pool.Close()
    pool.Wait()
    
    // 4. ê²°ê³¼ ìˆ˜ì§‘
    results := <-resultChan
    
    return results, nil
}
```

**ìˆ˜ì • í›„ ì½”ë“œ**:
```go
func ParseDiffParallel(diff string, workers int) ([]ParsedFile, error) {
    // ...
    pool := NewWorkerPool(workers)
    pool.Start()
    
    // 1. ê²°ê³¼ ìˆ˜ì§‘ goroutineì„ ë¨¼ì € ì‹œì‘!
    resultChan := make(chan []ParsedFile, 1)
    go func() {
        results := pool.Results()  // ì¦‰ì‹œ output ì±„ë„ì—ì„œ ì½ê¸° ì‹œì‘
        resultChan <- results
    }()
    
    // 2. ì‘ì—… ì œì¶œ
    for i, fileDiff := range fileDiffs {
        pool.Submit(fileDiff, i)  // ì›Œì»¤ë“¤ì´ ê²°ê³¼ë¥¼ ë³´ë‚´ë©´ ì¦‰ì‹œ ì†Œë¹„ë¨
    }
    
    // 3. ì‘ì—… ì™„ë£Œ ëŒ€ê¸°
    pool.Close()
    pool.Wait()
    
    // 4. ê²°ê³¼ ìˆ˜ì§‘
    results := <-resultChan
    
    return results, nil
}
```

**í•´ê²° ì›ë¦¬**:

1. **Consumer ë¨¼ì € ì‹œì‘**:
   - ê²°ê³¼ ìˆ˜ì§‘ goroutineì´ `pool.Results()`ë¥¼ í˜¸ì¶œí•˜ì—¬ `output` ì±„ë„ì—ì„œ ì½ê¸° ì‹œì‘
   - Consumerê°€ í•­ìƒ ì¤€ë¹„ëœ ìƒíƒœ

2. **Producerê°€ ììœ ë¡­ê²Œ ì‘ë™**:
   - ì›Œì»¤ë“¤ì´ ê²°ê³¼ë¥¼ `output` ì±„ë„ì— ì „ì†¡í•˜ë©´ Consumerê°€ ì¦‰ì‹œ ì†Œë¹„
   - `output` ë²„í¼ê°€ ê³„ì† ë¹„ì–´ìˆìœ¼ë¯€ë¡œ ì›Œì»¤ê°€ ë¸”ë¡ë˜ì§€ ì•ŠìŒ

3. **input ì±„ë„ë„ ììœ ë¡œì›Œì§**:
   - ì›Œì»¤ë“¤ì´ ë¸”ë¡ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ `input` ì±„ë„ì—ì„œ ì‘ì—…ì„ ê³„ì† êº¼ëƒ„
   - ë©”ì¸ goroutineì´ `input` ì±„ë„ì— ê³„ì† ì „ì†¡ ê°€ëŠ¥
   - `input` ë²„í¼ê°€ ê°€ë“ ì°¨ì§€ ì•ŠìŒ

**ì™œ ì´ ë°©ë²•ì´ ì •ì„ì¸ê°€?**

1. **Producer-Consumer íŒ¨í„´ì˜ ê¸°ë³¸ ì›ì¹™**:
   ```
   Producer (ì›Œì»¤ë“¤) â”€â”€â†’ output ì±„ë„ â”€â”€â†’ Consumer (ê²°ê³¼ ìˆ˜ì§‘ goroutine)
   ```
   - Consumerê°€ ë¨¼ì € ì±„ë„ì—ì„œ ì½ê¸° ì‹œì‘í•´ì•¼ Producerê°€ ë¸”ë¡ë˜ì§€ ì•ŠìŒ

2. **ë²„í¼ë¦¬ìŠ¤ ì±„ë„ì˜ ì„±ì§ˆ**:
   ```go
   ch := make(chan int)  // ë²„í¼ë¦¬ìŠ¤
   ch <- 42  // â† ëˆ„êµ°ê°€ ì½ì„ ë•Œê¹Œì§€ ë¸”ë¡ë¨
   <-ch      // â† ëˆ„êµ°ê°€ ë³´ë‚¼ ë•Œê¹Œì§€ ë¸”ë¡ë¨
   ```
   - ë²„í¼ë¦¬ìŠ¤ ì±„ë„ì€ ë™ê¸°ì ì„
   - ë³´ë‚´ëŠ” ìª½ê³¼ ë°›ëŠ” ìª½ì´ ë™ì‹œì— ì¤€ë¹„ë˜ì–´ì•¼ í•¨

3. **ì‹¤ë¬´ì—ì„œì˜ ì ìš© ì˜ˆì‹œ**:
   ```go
   // Go í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œë„ ê°™ì€ íŒ¨í„´
   out := make(chan Result)
   
   // Consumer ë¨¼ì € ì‹œì‘
   go func() {
       for r := range out {
           // ê²°ê³¼ ì²˜ë¦¬
       }
   }()
   
   // Producer ì‹œì‘
   for _, item := range items {
       out <- processItem(item)
   }
   close(out)
   ```

**ì„±ëŠ¥ ì˜í–¥**:
- CPU ì‚¬ìš©ëŸ‰: ë™ì¼ (ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰)
- ë©”ëª¨ë¦¬: ë” ì ìŒ (ë²„í¼ê°€ ì‘ì•„ë„ ë¨)
- ë³µì¡ë„: ë™ì¼ (ê°™ì€ ìˆ˜ì˜ goroutine)
- **ì°¨ì´ì : Deadlock ë°œìƒ ì—¬ë¶€**

**íš¨ê³¼**:
- ëŒ€ê·œëª¨ ì»¤ë°‹(17ê°œ ì´ìƒ íŒŒì¼)ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™
- Producer-Consumer íŒ¨í„´ì˜ ì •ì„ì  êµ¬í˜„
- ì±„ë„ ë²„í¼ í¬ê¸°ì— ëœ ì˜ì¡´ì 
- ë” ì•ˆì •ì ì¸ ë³‘ë ¬ ì²˜ë¦¬

---

## ê´€ë ¨ íŒŒì¼

- `internal/cache/cache.go`: ìºì‹œ ë§¤ë‹ˆì € êµ¬í˜„
- `internal/ui/selector.go`: UI ì˜µì…˜ ë° ì—ëŸ¬ íƒ€ì…
- `cmd/root.go`: ìºì‹œ í†µí•© ë° ì¬ì¶”ì²œ ë£¨í”„
- `internal/git/diff.go`: diff hash ê³„ì‚°, ì»¤ë°‹ íƒ€ì… ì¶”ë¡ , scope ì¶”ë¡ 
- `internal/llm/utils.go`: ì»¤ë°‹ ë©”ì‹œì§€ íŒŒì‹±

## ì°¸ê³ 

- [Conventional Commits](https://www.conventionalcommits.org/)
- [Go Error Handling Best Practices](https://go.dev/doc/tutorial/errors)
